<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Capacitación en Git con IA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .course-title {
            background: linear-gradient(135deg, #4F46E5, #3B82F6);
        }
        .card {
            transition: all 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
        }
        .accordion-button svg.arrow {
            transition: transform 0.3s ease;
        }
        .accordion-button.open svg.arrow {
            transform: rotate(180deg);
        }
        code.block {
            display: block;
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            margin-top: 0.5rem;
            margin-bottom: 1rem;
            font-size: 90%;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            position: relative;
        }
        code {
            background-color: #e5e7eb;
            color: #1f2937;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 6px;
            font-family: 'Courier New', Courier, monospace;
        }
        .content-icon {
            width: 28px;
            height: 28px;
            color: #4F46E5;
        }
        .glossary-term {
            border-left: 3px solid #6366f1;
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }
        .gemini-button {
            background-color: #ede9fe;
            color: #5b21b6;
            transition: background-color 0.2s;
        }
        .gemini-button:hover {
            background-color: #dcd7fe;
        }
         .gemini-button:disabled {
            background-color: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        .ai-feature-card {
             background-color: #faf5ff;
        }
        .ai-result {
            background-color: #fff;
            border-left: 4px solid #4ade80;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0 8px 8px 0;
        }
        #ai-modal-content strong, #workflow-result strong, #command-comparison-result strong { font-weight: bold; }
        #ai-modal-content ul, #workflow-result ul, #command-comparison-result ul { list-style-type: disc; margin-left: 20px; }

        /* Mind Map Styles */
        .mindmap { text-align: center; }
        .mindmap ul { padding: 0; margin: 0; display: inline-flex; }
        .mindmap li { list-style: none; padding: 1em; position: relative; }
        .mindmap-node { display: block; background: #fff; border: 2px solid #6366f1; color: #4338ca; padding: 0.5em 1em; border-radius: 8px; text-decoration: none; min-width: 120px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); transition: all 0.2s ease; }
        .mindmap-node:hover { background: #e0e7ff; transform: scale(1.05); }
        .mindmap-node.root { background: #4f46e5; color: white; border-color: #3730a3; }
        .mindmap ul ul { display: flex; flex-wrap: wrap; justify-content: center; margin-top: 1em; }
        .mindmap li::before, .mindmap li::after { content: ''; position: absolute; left: 50%; }
        .mindmap li::before { border-top: 2px solid #a5b4fc; top: 0; width: 0; height: 1em; }
        .mindmap ul > li:not(:only-child)::before { width: 100%; }
        .mindmap li:first-child::before { left: 50%; width: 50%; }
        .mindmap li:last-child::before { left: 0; width: 50%; }
        .mindmap li:first-child:last-child::before { width: 0; }
        .mindmap li::after { border-left: 2px solid #a5b4fc; top: 0; height: 100%; }
        .mindmap ul > li::after { height: 1em; }

        /* Progress Bar */
        #progress-container { background-color: #e5e7eb; border-radius: 8px; }
        #progress-bar { background: linear-gradient(90deg, #4f46e5, #3b82f6); transition: width 0.5s ease-out; }
        .lesson-checkbox { accent-color: #4f46e5; }
        .lesson-title-container { transition: color 0.3s; }
        .completed .lesson-title-container { color: #6b7280; text-decoration: line-through; }

        /* Quiz Styles */
        .quiz-option { cursor: pointer; border: 2px solid #d1d5db; }
        .quiz-option.selected { border-color: #4f46e5; background-color: #e0e7ff; }
        .quiz-option.correct { border-color: #22c55e; background-color: #dcfce7; }
        .quiz-option.incorrect { border-color: #ef4444; background-color: #fee2e2; }

    </style>
</head>
<body class="antialiased text-gray-800">

    <!-- Header -->
    <header class="course-title text-white p-8 md:p-12 shadow-lg">
        <div class="max-w-5xl mx-auto text-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 lucide lucide-git-branch-plus"><line x1="6" x2="6" y1="3" y2="15"/><path d="M18 9a3 3 0 0 0-3-3h-1.5"/><path d="M12 3a3 3 0 0 0-3 3v3"/><path d="M18 15a3 3 0 0 0 3 3h1.5"/><path d="M6 21a3 3 0 0 0 3-3v-3"/><line x1="15" x2="15" y1="12" y2="21"/><line x1="12" x2="18" y1="15" y2="15"/></svg>
            <h1 class="text-3xl md:text-5xl font-bold mb-2">Capacitación en Git: De Cero a Colaborador</h1>
            <p class="text-lg md:text-xl opacity-90">Un viaje práctico para dominar el control de versiones.</p>
            <p class="text-md md:text-lg opacity-80 mt-4">Un curso diseñado por el Arquitecto de Soluciones Kevin Aráuz</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-5xl mx-auto p-4 md:p-8">

        <!-- Progress Tracker -->
         <section class="mb-10 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-gray-700 mb-3">Tu Progreso</h2>
            <div id="progress-container" class="w-full h-4 overflow-hidden">
                <div id="progress-bar" class="h-full" style="width: 0%;"></div>
            </div>
            <p id="progress-text" class="text-center text-sm mt-2 text-gray-600">0% completado</p>
        </section>


        <!-- Methodology Section -->
        <section class="mb-10 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-gray-700 mb-3 border-b-2 border-blue-500 pb-2">Objetivo y Metodología</h2>
            <p class="mb-4 text-gray-600"><strong>Objetivo:</strong> Capacitar al estudiante para comprender y aplicar eficazmente los conceptos y comandos esenciales de Git, facilitando la gestión de versiones de proyectos y la colaboración en equipo.</p>
            <p class="text-gray-600"><strong>Metodología:</strong> Cada sesión de una hora incluirá una explicación teórica, la revisión de comandos clave y ejemplos prácticos. Se han añadido herramientas con IA, un mapa mental interactivo y seguimiento de progreso para una experiencia de aprendizaje completa.</p>
        </section>

        <!-- Interactive Mind Map -->
        <section class="mb-10 bg-white p-6 rounded-xl shadow-md">
            <div class="flex items-center mb-4">
                 <svg class="content-icon mr-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6v14a2 2 0 0 0 2 2h14"/><path d="M8 3a1 1 0 0 1 1-1h10a2 2 0 0 1 2 2v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V5a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h3"/><path d="M15 22v-4a2 2 0 0 1 2-2h4v-2a2 2 0 0 0-2-2H8"/></svg>
                <h2 class="text-2xl font-bold text-gray-700">Mapa Mental Interactivo del Curso</h2>
            </div>
             <p class="text-gray-600 mb-6 text-center">Usa este mapa para navegar rápidamente a cualquier tema del curso. ¡Haz clic en un nodo!</p>
            <div class="mindmap overflow-x-auto pb-4">
                <ul>
                    <li>
                        <a href="#" class="mindmap-node root">Curso de Git</a>
                        <ul id="mindmap-days">
                            <!-- Mindmap days will be injected here by JS -->
                        </ul>
                    </li>
                </ul>
            </div>
        </section>
        
        <!-- Glossary -->
        <section id="glossary-section" class="mb-10">
             <div class="card bg-white rounded-lg shadow-md overflow-hidden">
                <button class="accordion-button w-full flex justify-between items-center text-left p-5 focus:outline-none">
                    <div class="flex items-center space-x-4">
                        <svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                        <h2 class="text-2xl font-bold text-gray-700">Glosario de Términos Clave</h2>
                    </div>
                    <svg class="w-6 h-6 text-gray-500 arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="accordion-content">
                    <div id="glossary-container" class="p-5 pt-0 border-t border-gray-100 mt-2">
                        <!-- Glossary content will be injected here by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- New AI Features -->
        <section id="ai-features" class="mb-10 space-y-4">
            <!-- Error Solver -->
             <div class="card bg-white rounded-lg shadow-md overflow-hidden">
                <button class="accordion-button w-full flex justify-between items-center text-left p-5 focus:outline-none">
                    <div class="flex items-center space-x-4">
                       <svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        <h2 class="text-2xl font-bold text-gray-700">✨ Solucionador de Errores Comunes con IA</h2>
                    </div>
                    <svg class="w-6 h-6 text-gray-500 arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="accordion-content">
                    <div class="p-5 pt-0 border-t border-gray-100 mt-2">
                         <p class="text-gray-600 my-4">¿Te encontraste con un error en Git? Pega el mensaje aquí y la IA te explicará qué significa y cómo solucionarlo.</p>
                         <textarea id="error-description" class="w-full p-2 border rounded-md" placeholder="Ej: fatal: not a git repository (or any of the parent directories): .git"></textarea>
                         <button id="solve-error-btn" class="gemini-button mt-2 py-2 px-4 rounded-lg font-semibold text-sm">✨ Analizar Error</button>
                         <div id="error-solution-result" class="ai-result hidden"></div>
                    </div>
                </div>
             </div>

            <!-- Workflow Advisor -->
             <div class="card bg-white rounded-lg shadow-md overflow-hidden">
                <button class="accordion-button w-full flex justify-between items-center text-left p-5 focus:outline-none">
                    <div class="flex items-center space-x-4">
                        <svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.5 2c-1.8 0-3.5 1-4.5 2.5-1.8 2.5-2.3 5.5-1.5 8.5L3 18c-2 2-2 5 0 7h1c1 0 2-1 2-2l-1-4h4l2 4c1 1 2 2 3 2h5c2 0 3-1 3-3v-2.5c0-1.7-1.3-3-3-3l-2.5-1.5c-1-.5-2-1.5-2.5-2.5L14 8c-.5-2-2-3.5-4-4.5Z"/></svg>
                        <h2 class="text-2xl font-bold text-gray-700">✨ Asesor de Flujo de Trabajo con IA</h2>
                    </div>
                    <svg class="w-6 h-6 text-gray-500 arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="accordion-content">
                    <div class="p-5 pt-0 border-t border-gray-100 mt-2">
                         <p class="text-gray-600 my-4">Describe tu proyecto y la IA te recomendará el flujo de trabajo de Git (workflow) más adecuado.</p>
                         <textarea id="workflow-description" class="w-full p-2 border rounded-md" placeholder="Ej: Estoy trabajando solo en mi blog personal. O: Somos un equipo de 5 desarrolladores en una startup con despliegue continuo."></textarea>
                         <button id="recommend-workflow-btn" class="gemini-button mt-2 py-2 px-4 rounded-lg font-semibold text-sm">✨ Recomendar Flujo de Trabajo</button>
                         <div id="workflow-result" class="ai-result hidden"></div>
                    </div>
                </div>
             </div>

             <!-- Command Comparator -->
             <div class="card bg-white rounded-lg shadow-md overflow-hidden">
                <button class="accordion-button w-full flex justify-between items-center text-left p-5 focus:outline-none">
                    <div class="flex items-center space-x-4">
                        <svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><path d="M19 12H5"/><path d="m5 12-4-4"/><path d="m19 12 4 4"/><path d="m5 12 4 4"/><path d="m19 12-4-4"/></svg>
                        <h2 class="text-2xl font-bold text-gray-700">✨ Comparador de Comandos con IA</h2>
                    </div>
                    <svg class="w-6 h-6 text-gray-500 arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="accordion-content">
                    <div class="p-5 pt-0 border-t border-gray-100 mt-2">
                         <p class="text-gray-600 my-4">¿No estás seguro de cuándo usar un comando u otro? Elígelos de la lista y la IA te explicará la diferencia.</p>
                         <div class="flex items-center space-x-4">
                            <select id="command1-select" class="w-full p-2 border rounded-md bg-white"></select>
                            <span class="font-bold text-gray-500">vs</span>
                            <select id="command2-select" class="w-full p-2 border rounded-md bg-white"></select>
                         </div>
                         <button id="compare-commands-btn" class="gemini-button mt-2 py-2 px-4 rounded-lg font-semibold text-sm">✨ Comparar Comandos</button>
                         <div id="command-comparison-result" class="ai-result hidden"></div>
                    </div>
                </div>
             </div>
        </section>

        <!-- Course Lessons (Welcome card is now dynamically generated) -->
        <section id="course-lessons" class="space-y-4">
            <!-- Lessons will be dynamically injected here -->
        </section>
        
        <!-- Resource Center -->
        <section id="resource-center" class="mt-10 bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-gray-700 mb-4">Centro de Recursos Adicionales</h2>
            <ul class="list-disc list-inside space-y-3">
                <li><a href="https://git-scm.com/book/es/v2" target="_blank" class="text-indigo-600 hover:underline">Pro Git Book (Español)</a> - El libro oficial y una referencia indispensable.</li>
                <li><a href="https://learngitbranching.js.org/?locale=es_ES" target="_blank" class="text-indigo-600 hover:underline">Learn Git Branching</a> - Un tutorial interactivo para visualizar y practicar con ramas.</li>
                <li><a href="https://docs.github.com/es" target="_blank" class="text-indigo-600 hover:underline">Documentación de GitHub</a> - Guías y documentos oficiales de GitHub.</li>
                 <li><a href="https://docs.gitlab.com/" target="_blank" class="text-indigo-600 hover:underline">Documentación de GitLab</a> - Guías y documentos oficiales de GitLab.</li>
            </ul>
        </section>

    </main>
    
    <!-- AI Explanation & Quiz Modal -->
    <div id="ai-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-5 border-b flex justify-between items-center sticky top-0 bg-white">
                <h3 id="ai-modal-title" class="text-xl font-bold text-gray-800">✨</h3>
                <button id="ai-modal-close" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="ai-modal-content" class="p-6 text-gray-700 leading-relaxed">
                <!-- AI content goes here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center p-6 mt-10 bg-gray-800 text-gray-400">
        <p class="mb-2">Contenido y estructura por Kevin Aráuz, Arquitecto de Soluciones.</p>
        <p>&copy; 2025 Portal de Capacitación en Git. Potenciado con IA de Gemini.</p>
    </footer>

    <script>
        // --- DATA ---
        const glossaryData = [
            { term: "git init", concept: "Crea un repositorio de Git vacío en un directorio. Es el primer comando que se ejecuta al iniciar un nuevo proyecto desde cero.", options: { "<code>--bare</code>": "Crea un repositorio 'desnudo', sin directorio de trabajo, usado para servidores centrales." }, example: `# Convertir el directorio actual en un repositorio de Git\ngit init` },
            { term: "git config", concept: "Establece o consulta variables de configuración de Git.", options: { "<code>--global</code>": "Aplica la configuración a todos tus repositorios.", "<code>--local</code>": "Aplica la configuración solo al repositorio actual.", "<code>--list</code>": "Muestra la configuración actual." }, example: `# Establecer tu nombre para todos tus repositorios\ngit config --global user.name "Tu Nombre"\n\n# Ver toda la configuración\ngit config --list` },
            { term: "git commit", concept: "Crea una 'instantánea' en el historial del proyecto con los cambios del Staging Area.", options: { "<code>-m \"mensaje\"</code>": "Añade un mensaje de commit en la línea de comandos.", "<code>--amend</code>": "Modifica el commit más reciente." }, example: `# Crear un commit con un mensaje\ngit commit -m "feat: Agrega el botón de login"\n\n# Corregir el mensaje del último commit\ngit commit --amend -m "fix: Corrige el texto del botón"` },
            { term: "git status", concept: "Muestra el estado del directorio de trabajo y del Staging Area.", options: { "<code>-s</code> o <code>--short</code>": "Vista compacta.", "<code>-b</code> o <code>--branch</code>": "Muestra el nombre de la rama." }, example: `# Ver el estado detallado\ngit status\n\n# Ver el estado resumido y la rama\ngit status -sb` },
            { term: "git add", concept: "Añade cambios al Área de Preparación para ser incluidos en el próximo commit.", options: { "<code>.</code>": "Añade todos los archivos modificados y nuevos.", "<code>-p</code> o <code>--patch</code>": "Permite añadir cambios de forma interactiva." }, example: `# Añadir un archivo específico\ngit add index.html\n\n# Añadir todos los cambios\ngit add .` },
            { term: "git checkout", concept: "Permite cambiar entre ramas o restaurar archivos.", options: { "<code>-b &lt;rama&gt;</code>": "Crea una nueva rama y cambia a ella.", "<code>-- &lt;archivo&gt;</code>": "Descarta los cambios en un archivo." }, example: `# Crear y cambiar a una nueva rama\ngit checkout -b feature/user-profile\n\n# Descartar cambios en un archivo\ngit checkout -- styles/main.css` },
            { term: "git log", concept: "Muestra el historial de commits.", options: { "<code>--oneline</code>": "Vista compacta.", "<code>--graph</code>": "Gráfico de ramas.", "<code>--decorate</code>": "Muestra nombres de ramas/etiquetas." }, example: `# El comando más útil para un historial visual\ngit log --oneline --graph --decorate\n\n# Ver los cambios de los últimos 2 commits\ngit log -p -2` },
            { term: "git merge", concept: "El acto de integrar los cambios de una rama en otra.", options: { "<code>--no-ff</code>": "Crea siempre un commit de fusión, manteniendo un historial más claro.", "<code>--abort</code>": "Aborta el proceso de fusión si hay conflictos y devuelve todo al estado anterior." }, example: `# Estando en la rama 'main', fusionar los cambios de 'feature/nuevo-logo'\ngit merge feature/nuevo-logo\n\n# Abortar una fusión con conflictos\ngit merge --abort` },
            { term: "git revert", concept: "Crea un nuevo commit que deshace los cambios de un commit anterior. Es la forma más segura de revertir cambios, ya que no reescribe el historial.", options: { "<code>--no-commit</code>": "Prepara la reversión en el staging, pero no crea el commit de reversión automáticamente.", "<code>-e / --edit</code>": "Permite editar el mensaje del commit de reversión antes de crearlo (comportamiento por defecto)." }, example: `# Revertir los cambios introducidos en el último commit\ngit revert HEAD\n\n# Revertir un commit específico por su hash\ngit revert a1b2c3d4`},
            { term: "git remote", concept: "Gestiona las conexiones con repositorios remotos.", options: { "<code>-v</code>": "Muestra las URLs de los remotos.", "<code>add &lt;nombre&gt; &lt;url&gt;</code>": "Añade un nuevo remoto.", "<code>remove &lt;nombre&gt;</code>": "Elimina un remoto." }, example: `# Añadir una conexión a un repositorio remoto llamado 'origin'\ngit remote add origin https://github.com/usuario/repo.git\n\n# Ver los remotos configurados\ngit remote -v` },
            { term: "git push", concept: "Envía tus commits locales a un repositorio remoto para compartirlos.", options: { "<code>-u origin &lt;rama&gt;</code>": "Sube la rama y establece una relación de seguimiento para futuros pushes.", "<code>--force</code>": "Fuerza la subida. ¡Peligroso, puede sobreescribir el historial remoto!", "<code>--tags</code>": "Sube todas las etiquetas locales." }, example: `# Subir la rama 'main' y establecer seguimiento\ngit push -u origin main\n\n# Subir todas las etiquetas\ngit push --tags` },
            { term: "git pull", concept: "Descarga cambios desde un remoto y los fusiona en tu rama local (es un `fetch` + `merge`).", options: { "<code>--rebase</code>": "Descarga los cambios y los aplica 'encima' de tus commits locales, manteniendo un historial lineal.", "<code>--prune</code>": "Elimina las ramas locales que ya no existen en el remoto." }, example: `# Descargar y fusionar cambios de la rama 'main' de 'origin'\ngit pull origin main\n\n# Descargar cambios y reorganizar tu historial local\ngit pull --rebase` },
            { term: "git tag", concept: "Crea una etiqueta (un alias legible) para marcar un commit específico, usualmente para versiones.", options: { "<code>-a &lt;nombre&gt;</code>": "Crea una etiqueta anotada (con metadatos: autor, fecha, mensaje).", "<code>-m &lt;mensaje&gt;</code>": "Añade un mensaje a una etiqueta anotada.", "<code>-d &lt;nombre&gt;</code>": "Elimina una etiqueta." }, example: `# Crear una etiqueta anotada para una versión\ngit tag -a v1.0 -m "Lanzamiento versión 1.0"\n\n# Eliminar una etiqueta local\ngit tag -d v1.0` }
        ];
        const courseLessons = [
            { type: 'welcome', id: 'lesson-1', shortTitle: 'Bienvenida' },
            { id: "lesson-2", shortTitle: 'Instalación', title: "Instalación de Git", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>`, content: [ "Instalación en Windows, macOS y Linux.", "Verificación con <code>git --version</code>." ] },
            { id: "lesson-3", shortTitle: 'Identidad', title: "Configuración Inicial - Identidad", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`, content: [ "Configurar <code>user.name</code> y <code>user.email</code>.", "Verificar con <code>git config --list</code>." ] },
            { id: "lesson-4", shortTitle: 'Alias', title: "Personalización Avanzada", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>`, content: [ "Crear alias para comandos frecuentes.", "Configurar editor de texto y colores." ] },
            { id: "lesson-5", shortTitle: 'Repos', title: "Creación y Clonación de Repositorios", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"/><polyline points="14 2 14 8 20 8"/><path d="m3 12.5 3.5 3-3.5 3"/><path d="M9 18h1"/></svg>`, content: [ "Inicializar un repositorio con <code>git init</code>.", "Clonar un repositorio con <code>git clone</code>." ] },
            { id: "lesson-6", shortTitle: 'Commits', title: "Guardando Cambios: Staging y Commits", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22a10 10 0 1 1 0-20 10 10 0 0 1 0 20Z"/><path d="m9 12 2 2 4-4"/></svg>`, content: [ "Las 3 zonas de trabajo: Directorio, Staging, Repositorio.", "Flujo de trabajo: modificar, <code>add</code>, <code>commit</code>.", "Ignorar archivos con <code>.gitignore</code>." ] },
            { id: "lesson-7", shortTitle: 'Historia', title: "Historial y Deshacer Cambios", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>`, content: [ "Visualizar historial con <code>git log</code>.", "Deshacer cambios de forma segura con <code>git revert</code>.", "Descartar cambios locales con <code>git checkout -- &lt;file&gt;</code>." ] },
            { id: "lesson-8", shortTitle: 'Ramas', title: "Ramificación (Branches)", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v12"/><path d="M18 9a3 3 0 0 0-3-3h-1.5"/><path d="M12 3a3 3 0 0 0-3 3v3"/><path d="M6 21a3 3 0 0 0 3-3v-3"/><path d="M18 21a3 3 0 0 0-3-3v-3"/></svg>`, content: [ "Concepto de ramas.", "Crear y cambiar de rama con <code>git checkout -b</code>.", "Listar ramas con <code>git branch</code>." ] },
            { id: "lesson-9", shortTitle: 'Colaboración', title: "Fusión, Colaboración y Etiquetado", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 15V6"/><path d="M15 18H9"/><path d="M12 3v15"/><path d="M6 3v6"/></svg>`, content: [ "Fusionar ramas con <code>git merge</code>.", "Colaboración remota: <code>push</code> y <code>pull</code>.", "Marcar versiones con <code>git tag</code>." ] },
            { id: "lesson-10", shortTitle: 'Workflows', title: "Flujos de Trabajo y Herramientas", icon: `<svg class="content-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6.1a4.6 4.6 0 0 0-1.3-3.2 4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.7 2.7 5.8 5.5 6.1-.6.5-.9 1.2-.9 2.2V22"/></svg>`, content: [ "Modelos de flujo de trabajo: GitHub-Flow.", "Colaborar con Forks y Pull Requests.", "Clientes GUI para Git." ] }
        ];

        // --- SETUP FUNCTIONS ---
        function createGlossaryTerm(data) {
            let optionsHtml = Object.entries(data.options).map(([option, description]) => 
                `<dt class="font-semibold">${option}</dt><dd class="text-gray-600 mb-2 ml-4">${description}</dd>`
            ).join('');
            return `<div class="glossary-term"><h3 class="font-bold text-lg">${data.term}</h3><dl class="ml-4 mt-2 text-sm"><dt class="font-semibold">Concepto:</dt><dd class="text-gray-600 mb-2">${data.concept}</dd><dt class="font-semibold">Opciones Clave:</dt><dl class="ml-4">${optionsHtml}</dl><dt class="font-semibold mt-2">Ejemplo de Uso:</dt><dd><code class="block">${data.example}</code></dd></dl><button class="gemini-button explain-btn mt-2 py-1 px-3 rounded-lg font-semibold text-xs" data-command="${data.term}">✨ Explicar con IA</button></div>`;
        }
        
        function createDailyLessonItem(item) {
            const contentList = item.content.map(point => `<li class="mb-2 text-gray-600">${point}</li>`).join('');
            const card = document.createElement('div');
            card.id = item.id;
            card.className = "card bg-white rounded-lg shadow-md overflow-hidden";
            card.innerHTML = `<button class="accordion-button w-full flex justify-between items-center text-left p-5 focus:outline-none"><div class="flex items-center space-x-4"><input type="checkbox" class="lesson-checkbox h-5 w-5" data-lesson-id="${item.id}"><div class="lesson-title-container flex-grow flex items-center">${item.icon}<div class="ml-4"><h3 class="text-lg font-semibold text-gray-800 mt-1">${item.title}</h3></div></div></div><svg class="w-6 h-6 text-gray-500 arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg></button><div class="accordion-content"><div class="p-5 pt-0 border-t border-gray-100 mt-2"><ul class="list-disc list-inside space-y-3 mt-4">${contentList}</ul></div></div>`;
            return card;
        }

        function createWelcomeCard() {
             const card = document.createElement('div');
             card.id = 'lesson-1';
             card.className = "card bg-white rounded-lg shadow-md overflow-hidden p-6";
             card.innerHTML = `
                <div class="flex items-center space-x-4">
                     <input type="checkbox" class="lesson-checkbox h-5 w-5" data-lesson-id="lesson-1">
                     <div class="lesson-title-container flex-grow">
                        <h2 class="text-2xl font-bold text-gray-800">¡Bienvenido al Mundo de Git!</h2>
                        <p class="text-gray-600 mt-2">Has dado el primer paso para dominar la herramienta más importante en el desarrollo de software moderno. Este curso te llevará de cero a poder controlar tus proyectos y colaborar con equipos profesionales.</p>
                     </div>
                </div>
                <div class="mt-6">
                    <h3 class="text-xl font-bold text-center text-indigo-700 mb-4">¿Qué Lograrás con este Curso?</h3>
                    <div class="grid md:grid-cols-3 gap-6 text-center">
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            <h4 class="font-semibold mt-2">Versionar tus Proyectos</h4>
                            <p class="text-sm text-gray-600">Nunca más perderás un cambio. Aprenderás a crear un historial completo de tu trabajo.</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                            <h4 class="font-semibold mt-2">Colaborar sin Caos</h4>
                            <p class="text-sm text-gray-600">Descubrirás cómo trabajar en equipo de forma ordenada, integrando cambios sin sobreescribir el trabajo de otros.</p>
                        </div>
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <svg class="mx-auto h-12 w-12 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h5M20 20v-5h-5" /><path d="M4 9a9 9 0 0114.1-3.9" /><path d="M20 15a9 9 0 01-14.1 3.9" /></svg>
                            <h4 class="font-semibold mt-2">Viajar en el Tiempo</h4>
                            <p class="text-sm text-gray-600">Ganarás la confianza de experimentar, sabiendo que siempre puedes revertir errores y volver a una versión estable.</p>
                        </div>
                    </div>
                </div>
             `;
             return card;
        }

        function createQuizButton(topics) {
            return `<div class="my-8 text-center"><button class="gemini-button quiz-btn py-3 px-8 rounded-lg font-bold text-lg" data-topics="${topics}">🎓 Examen Final del Curso</button></div>`
        }

        // --- GEMINI API ---
        async function callGemini(prompt, button) {
            if(button) {
                button.disabled = true;
                button.innerText = 'Pensando...';
            }
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error(`Error de red: ${response.statusText}`);
                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts.length > 0) {
                     return result.candidates[0].content.parts[0].text;
                }
                return "No se pudo obtener una respuesta de la IA.";
            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                return `Error: No se pudo conectar con el servicio de IA. Por favor, revisa la consola para más detalles.`;
            } finally {
                 if(button) button.disabled = false;
            }
        }

        function simpleMarkdownToHtml(text) {
             return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\* (.*?)(?:\n|$)/g, (match, content) => `<ul><li class="mb-2">${content.trim()}</li></ul>`).replace(/\n/g, '<br>');
        }
        
        // --- MODAL & QUIZ LOGIC ---
        const modal = document.getElementById('ai-modal');
        const modalClose = document.getElementById('ai-modal-close');
        const modalTitle = document.getElementById('ai-modal-title');
        const modalContent = document.getElementById('ai-modal-content');
        
        function showModal(title, content) {
            modalTitle.innerText = title;
            modalContent.innerHTML = content;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        modalClose.addEventListener('click', () => {
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        });

        // --- EVENT LISTENERS & INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            const lessonsContainer = document.getElementById('course-lessons');
            
            // Populate content
            document.getElementById('glossary-container').innerHTML = `<div class="mt-4 space-y-4">${glossaryData.map(createGlossaryTerm).join('')}</div>`;
            
            // Add Welcome card first
            lessonsContainer.appendChild(createWelcomeCard());
            // Add the rest of the lessons
            courseLessons.slice(1).forEach(item => lessonsContainer.appendChild(createDailyLessonItem(item)));
            // Add final quiz button
            lessonsContainer.insertAdjacentHTML('beforeend', createQuizButton("Todos los temas del curso"));
            
            // Populate mindmap
            const mindmapContainer = document.getElementById('mindmap-days');
            mindmapContainer.innerHTML = courseLessons.map(item => `<li><a href="#${item.id}" class="mindmap-node mindmap-link">${item.shortTitle}</a></li>`).join('');


            // Populate command comparator dropdowns
            const cmdSelect1 = document.getElementById('command1-select');
            const cmdSelect2 = document.getElementById('command2-select');
            glossaryData.sort((a,b) => a.term.localeCompare(b.term)).forEach(item => {
                const command = item.term;
                cmdSelect1.innerHTML += `<option value="${command}">${item.term}</option>`;
                cmdSelect2.innerHTML += `<option value="${command}">${item.term}</option>`;
            });
            cmdSelect1.value = "git pull";
            cmdSelect2.value = "git fetch";


            // --- PROGRESS TRACKER LOGIC ---
            const lessonCheckboxes = document.querySelectorAll('.lesson-checkbox');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const totalLessons = lessonCheckboxes.length;
            let completedLessons = 0;

            function updateProgress() {
                completedLessons = document.querySelectorAll('.lesson-checkbox:checked').length;
                const percentage = totalLessons > 0 ? (completedLessons / totalLessons) * 100 : 0;
                progressBar.style.width = `${percentage}%`;
                progressText.innerText = `${Math.round(percentage)}% completado (${completedLessons} de ${totalLessons} lecciones)`;
            }

            lessonCheckboxes.forEach(checkbox => {
                const lessonId = checkbox.dataset.lessonId;
                if (localStorage.getItem(lessonId) === 'true') {
                    checkbox.checked = true;
                    checkbox.closest('.card').querySelector('.lesson-title-container').classList.add('completed');
                }

                checkbox.addEventListener('change', () => {
                    localStorage.setItem(lessonId, checkbox.checked);
                    checkbox.closest('.card').querySelector('.lesson-title-container').classList.toggle('completed', checkbox.checked);
                    updateProgress();
                });
            });

            updateProgress();
            
            // --- AI FEATURE EVENT LISTENERS ---
            document.body.addEventListener('click', async (e) => {
                // Delegated event listeners
                if (e.target.matches('.explain-btn')) {
                    const command = e.target.dataset.command;
                    showModal(`✨ Explicando: ${command}`, 'Cargando explicación...');
                    const prompt = `Explica el comando de git "${command}" para un principiante. Detalla qué hace, cuándo se usa comúnmente, y un ejemplo práctico. La respuesta debe estar en español y usar Markdown simple (solo ** para negritas y * para listas).`;
                    const response = await callGemini(prompt);
                    modalContent.innerHTML = simpleMarkdownToHtml(response);
                }

                if (e.target.matches('.quiz-btn')) {
                    const button = e.target;
                    const topics = button.dataset.topics;
                    showModal(`🎓 Examen Final`, 'Generando preguntas...');
                    
                    const prompt = `Genera un quiz de 5 preguntas de opción múltiple en español sobre los siguientes temas de Git: ${topics}. La respuesta DEBE ser un objeto JSON válido, sin nada más antes o después. La estructura debe ser un array de objetos, donde cada objeto tiene las claves "question" (string), "options" (array de 4 strings), y "answer" (el string de la opción correcta).`;

                    try {
                        const response = await callGemini(prompt, button);
                        const cleanedResponse = response.replace(/^```json\s*|```$/g, '');
                        const quizData = JSON.parse(cleanedResponse);
                        renderQuiz(quizData);
                        button.innerText = `🎓 Examen Final del Curso`
                    } catch (err) {
                        console.error("Error al generar o parsear el quiz:", err, "Respuesta cruda:", response);
                        modalContent.innerHTML = "Hubo un error al generar el quiz. La respuesta de la IA no fue un JSON válido. Inténtalo de nuevo.";
                        button.innerText = `🎓 Examen Final del Curso`
                    }
                }
            });
            
            const generateCommitBtn = document.getElementById('generate-commit-msg-btn');
            if (generateCommitBtn) {
                generateCommitBtn.addEventListener('click', async (e) => {
                    const button = e.target;
                    const description = document.getElementById('commit-description').value.trim();
                    if (!description) { alert("Por favor, describe tus cambios primero."); return; }
                    const prompt = `Basado en la siguiente descripción de cambios: "${description}", genera un mensaje de commit semántico en una sola línea, en español, siguiendo el estándar de Conventional Commits (ej. feat:, fix:, docs:). Solo devuelve el mensaje del commit, sin explicaciones ni comillas al inicio/final.`;
                    const response = await callGemini(prompt, button);
                    document.getElementById('commit-msg-result').querySelector('code').innerText = response.trim();
                    document.getElementById('commit-msg-result').classList.remove('hidden');
                    button.innerText = '✨ Generar Mensaje';
                });
            }
            
            const recommendWorkflowBtn = document.getElementById('recommend-workflow-btn');
            if(recommendWorkflowBtn) {
                recommendWorkflowBtn.addEventListener('click', async (e) => {
                     const button = e.target;
                     const description = document.getElementById('workflow-description').value.trim();
                     if (!description) { alert("Por favor, describe tu proyecto."); return; }
                     const resultDiv = document.getElementById('workflow-result');
                     resultDiv.innerHTML = 'Buscando la mejor estrategia para ti...';
                     resultDiv.classList.remove('hidden');
                     const prompt = `Soy un desarrollador aprendiendo Git. Recomienda el mejor flujo de trabajo (workflow) para el siguiente proyecto: "${description}". Considera que a nivel profesional se usan flujos como GitHub Flow y GitLab Flow. Explica las ramas principales (main, develop, etc.), cómo se añadiría una nueva funcionalidad, y las ventajas de este modelo para este caso específico. La respuesta debe ser en español y formateada con Markdown simple.`;
                     const response = await callGemini(prompt, button);
                     resultDiv.innerHTML = simpleMarkdownToHtml(response);
                     button.innerText = '✨ Recomendar Flujo de Trabajo';
                     const accordionContent = resultDiv.closest('.accordion-content');
                     if(accordionContent.style.maxHeight !== "0px") accordionContent.style.maxHeight = accordionContent.scrollHeight + "px";
                });
            }

            const compareCommandsBtn = document.getElementById('compare-commands-btn');
            if(compareCommandsBtn) {
                compareCommandsBtn.addEventListener('click', async (e) => {
                     const button = e.target;
                     const cmd1 = document.getElementById('command1-select').value;
                     const cmd2 = document.getElementById('command2-select').value;
                     if (!cmd1 || !cmd2 || cmd1 === cmd2) { alert("Por favor, elige dos comandos diferentes para comparar."); return; }
                     const resultDiv = document.getElementById('command-comparison-result');
                     resultDiv.innerHTML = 'Analizando las diferencias...';
                     resultDiv.classList.remove('hidden');
                     const prompt = `Para un principiante en Git, explica la diferencia fundamental entre los comandos "git ${cmd1}" y "git ${cmd2}". Enfócate en su propósito principal, cuándo es mejor usar cada uno, y los posibles riesgos o resultados. La respuesta debe ser clara, concisa, en español y usar Markdown simple.`;
                     const response = await callGemini(prompt, button);
                     resultDiv.innerHTML = simpleMarkdownToHtml(response);
                     button.innerText = '✨ Comparar Comandos';
                     const accordionContent = resultDiv.closest('.accordion-content');
                     if(accordionContent.style.maxHeight !== "0px") accordionContent.style.maxHeight = accordionContent.scrollHeight + "px";
                });
            }

            const solveErrorBtn = document.getElementById('solve-error-btn');
            if(solveErrorBtn) {
                 solveErrorBtn.addEventListener('click', async (e) => {
                     const button = e.target;
                     const errorMsg = document.getElementById('error-description').value.trim();
                     if (!errorMsg) { alert("Por favor, pega el mensaje de error de Git."); return; }
                     const resultDiv = document.getElementById('error-solution-result');
                     resultDiv.innerHTML = 'Analizando el error...';
                     resultDiv.classList.remove('hidden');
                     const prompt = `Como un experto en Git, he recibido el siguiente mensaje de error: "${errorMsg}". Explícame en español, de forma sencilla, qué significa este error, por qué ocurre comúnmente y dame los pasos claros para solucionarlo. Usa Markdown simple.`;
                     const response = await callGemini(prompt, button);
                     resultDiv.innerHTML = simpleMarkdownToHtml(response);
                     button.innerText = '✨ Analizar Error';
                     const accordionContent = resultDiv.closest('.accordion-content');
                     if(accordionContent.style.maxHeight !== "0px") accordionContent.style.maxHeight = accordionContent.scrollHeight + "px";
                });
            }

            function renderQuiz(quizData) {
                let quizHtml = '<div id="quiz-form" class="space-y-6">';
                quizData.forEach((q, index) => {
                    const optionsHtml = q.options.map(opt => `
                        <div class="quiz-option p-3 rounded-lg">${opt}</div>
                    `).join('');
                    quizHtml += `
                        <div class="quiz-question" data-answer="${q.answer}">
                            <p class="font-semibold mb-2">${index + 1}. ${q.question}</p>
                            <div class="space-y-2">${optionsHtml}</div>
                        </div>
                    `;
                });
                quizHtml += '</div><button id="submit-quiz-btn" class="gemini-button mt-6 py-2 px-4 rounded-lg font-semibold">Revisar Respuestas</button><div id="quiz-results" class="mt-4"></div>';
                modalContent.innerHTML = quizHtml;
                
                modalContent.querySelectorAll('.quiz-option').forEach(option => {
                    option.addEventListener('click', () => {
                        option.parentElement.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                    });
                });

                document.getElementById('submit-quiz-btn').addEventListener('click', () => {
                    let score = 0;
                    document.querySelectorAll('.quiz-question').forEach(q => {
                        const correctAnswer = q.dataset.answer;
                        const selectedOption = q.querySelector('.quiz-option.selected');
                        q.querySelectorAll('.quiz-option').forEach(opt => {
                             if(opt.innerText === correctAnswer) {
                                opt.classList.add('correct');
                             } else if (opt.classList.contains('selected')) {
                                opt.classList.add('incorrect');
                             }
                        });

                        if(selectedOption && selectedOption.innerText === correctAnswer) {
                            score++;
                        }
                    });
                    document.getElementById('quiz-results').innerHTML = `<p class="text-xl font-bold mt-4 text-center">Tu puntuación: ${score} de ${quizData.length}</p>`;
                    document.getElementById('submit-quiz-btn').style.display = 'none';
                });
            }

            // --- GENERAL UI ---
            document.body.addEventListener('click', (e) => {
                if (e.target.closest('.accordion-button')) {
                    const button = e.target.closest('.accordion-button');
                    const accordionContent = button.nextElementSibling;
                    button.classList.toggle('open');
                    
                    if (button.classList.contains('open')) {
                        accordionContent.style.maxHeight = accordionContent.scrollHeight + 50 + 'px';
                    } else {
                        accordionContent.style.maxHeight = '0px';
                    }
                }
            });
            
            document.querySelectorAll('.mindmap-link').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        const accordionButton = targetElement.querySelector('.accordion-button');
                        if(accordionButton && !accordionButton.classList.contains('open')) accordionButton.click();
                        setTimeout(() => {
                             targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 300);
                    }
                });
            });
        });

    </script>
</body>
</html>
